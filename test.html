<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEPPY and LADIES — PICKLEBALL CUP</title>

<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:url("image.jpg") center/cover fixed;
    padding:20px;
  }

  h1{
    text-align:center;
    color:white;
    text-shadow:2px 2px 4px #000;
    margin:0 0 6px 0;
    line-height:1.2;
    font-size: clamp(20px, 4vw, 40px);
  }
  h2.title{
    text-align:center;
    color:white;
    margin:0 0 18px 0;
    font-size: clamp(16px, 3vw, 28px);
    text-shadow:2px 2px 4px #000;
  }

  .block{
    background:#ffffffdd;
    padding:12px;
    border-radius:10px;
    margin-bottom:20px;
    border:2px solid #444;
  }
  table{
    width:100%;
    border-collapse:collapse;
    margin-bottom:8px;
  }

  td,th{
    border:1px solid #444;
    padding:6px 8px;

    /* CHO PHÉP XUỐNG DÒNG */
    white-space: normal !important;
    word-break: break-word;

    font-size: clamp(8px, 1.4vw, 18px);
  }

  .section-title{
    padding:8px;
    font-weight:700;
    background:#eee;
    margin:10px 0;
    border-left:5px solid #333;
    white-space: nowrap;
    font-size: clamp(14px, 1.6vw, 20px);
  }

  .doi-scroll{
    display:flex;
    gap:12px;
    overflow-x:auto;
    padding:8px 0;
  }
  .doi-card{
    min-width:160px;
    background:#fff;
    border-radius:8px;
    padding:8px;
    border:1px solid #ccc;
  }
</style>

<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
google.charts.load('current', {'packages':['table']});

const SHEET_ID = "1QOnDy3RJydEpNXnuTdRzUTwCNohp00FzZxA7xCraXAY";

/* Promise-based wrapper cho google.visualization.Query */
function loadSheetPromise(sheetName, range){
  return new Promise((resolve) => {
    const q = new google.visualization.Query(
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(sheetName)}&range=${encodeURIComponent(range)}`
    );
    q.send(res=>{
      if(res.isError()){
        resolve(null);
      } else {
        resolve(res.getDataTable());
      }
    });
  });
}

/* ============================
   XỬ LÝ XUỐNG DÒNG CHO CỘT TÙY CHỌN
   ============================ */

/* Cột tùy chọn là cột số 5 → index = 4  
   (nếu bạn muốn đổi cột khác, đổi số dưới đây)
*/
const COLUMN_WITH_LINEBREAK = 4;

/* DataTable -> HTML table */
function tableToHTML(data){
  if(!data) return '<div style="padding:8px;color:#a00">Không thể tải dữ liệu</div>';

  let html = "<table><tbody>";

  for(let r=0;r<data.getNumberOfRows();r++){
    html += "<tr>";

    for(let c=0;c<data.getNumberOfColumns();c++){
      let cell = data.getValue(r,c) ?? "";

      // ---- CHỈ XUỐNG DÒNG KHI GẶP " - " ----
      // ---- CHỈ ÁP DỤNG CHO CỘT TÙY CHỌN ----
      if (c === COLUMN_WITH_LINEBREAK) {
        cell = cell.toString().replace(/ - /g, "<br>");
      }

      html += `<td>${cell}</td>`;
    }

    html += "</tr>";
  }

  html += "</tbody></table>";
  return html;
}

/* ============================
   LOAD & RENDER (theo thứ tự)
   ============================ */

async function loadDoiOrdered(){
  const ranges = [
    {range:"A1:B5", label:"Bảng A"},
    {range:"A7:B11", label:"Bảng B"},
    {range:"A13:B17", label:"Bảng C"},
    {range:"A19:B23", label:"Bảng D"}
  ];

  let html = '<div class="doi-scroll">';
  for(const r of ranges){
    const data = await loadSheetPromise("doi", r.range);
    html += `<div class="doi-card"><div class="section-title" style="margin:0 0 8px 0">${r.label}</div>`;
    html += tableToHTML(data);
    html += '</div>';
  }
  html += '</div>';

  document.getElementById('sheet-doi').innerHTML = html;
}

async function loadBangOrdered(){
  const ranges = [
    {range:"A2:G8", label:"BẢNG A"},
    {range:"A11:G17", label:"BẢNG B"},
    {range:"A20:G26", label:"BẢNG C"},
    {range:"A29:G35", label:"BẢNG D"}
  ];

  let html = "";
  for(const r of ranges){
    const data = await loadSheetPromise("bang", r.range);
    html += `<div class="section-title">${r.label}</div>`;
    html += tableToHTML(data);
  }

  document.getElementById('sheet-bang').innerHTML = html;
}

async function loadOtherSheets(){
  const data18 = await loadSheetPromise("1.8","A1:E12");
  document.getElementById('sheet-18').innerHTML = tableToHTML(data18);

  const databk = await loadSheetPromise("bk","A1:D7");
  document.getElementById('sheet-bk').innerHTML = tableToHTML(databk);

  const datack = await loadSheetPromise("ck","A2:C4");
  document.getElementById('sheet-ck').innerHTML = tableToHTML(datack);
}

async function reloadAllOrdered(){
  await loadDoiOrdered();
  await loadBangOrdered();
  await loadOtherSheets();
}

google.charts.setOnLoadCallback(()=>{
  reloadAllOrdered();
  setInterval(reloadAllOrdered, 60000);
});
</script>
</head>
<body>

<h1>TEPPY and LADIES</h1>
<h2 class="title">PICKLEBALL CUP</h2>
<h2 class="title">21/12/2025</h2>

<div class="block">
  <div class="section-title">DANH SÁCH ĐỘI</div>
  <div id="sheet-doi"></div>
</div>

<div class="block">
  <div class="section-title">BẢNG THI ĐẤU</div>
  <div id="sheet-bang"></div>
</div>

<div class="block">
  <div class="section-title">VÒNG LOẠI 1/8</div>
  <div id="sheet-18"></div>
</div>

<div class="block">
  <div class="section-title">BÁN KẾT</div>
  <div id="sheet-bk"></div>
</div>

<div class="block">
  <div class="section-title">CHUNG KẾT</div>
  <div id="sheet-ck"></div>
</div>

</body>
</html>
