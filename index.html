<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TEPPY and LADIES - PICKLEBALL CUP</title>

<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    margin: 0;
    padding: 25px;
    color: #111;

    background: url("image.jpg") no-repeat center center fixed;
    background-size: cover;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.72);
    backdrop-filter: blur(2px);
    z-index: -1;
  }

  .title {
    text-align: center;
    margin-bottom: 25px;
    line-height: 1.4;
  }
  .title h1 { margin: 0; font-size: 32px; font-weight: bold; color: #0f172a; }
  .title h2 { margin: 0; font-size: 26px; color: #1e3a8a; }
  .title h3 { margin: 0; font-size: 20px; color: #475569; }

  .card {
    background: #ffffffcc;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  }

  table {
    border-collapse: separate;
    border-spacing: 0;
    width: 100%;
    margin-top: 14px;
    font-size: 15px;
  }

  th {
    background: #1d4ed8;
    color: white;
    padding: 10px;
    border: 1px solid #c6d4f7;
    font-weight: bold;
  }

  td {
    border: 1px solid #d6d8df;
    padding: 8px 10px;
  }

  tbody tr:nth-child(odd) { background: #f8fafc; }
  tbody tr:nth-child(even) { background: #eef2f7; }
  tbody tr:hover { background: #dbeafe; }

  td:first-child {
    background: #e0ecff;
    font-weight: bold;
  }

  /* ===== PHÂN NHÓM ===== */
  .group-box {
    border: 3px solid #0f172a;
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 26px;
    background: #ffffffdd;
  }

  .group-title {
    font-weight: bold;
    font-size: 18px;
    color: #0f172a;
    margin-bottom: 10px;
    text-align: center;
  }

  .loading {
    margin-top: 10px;
    color: #0f172a;
  }
</style>
</head>

<body>

<div class="title">
  <h1>TEPPY and LADIES</h1>
  <h2>PICKLEBALL CUP</h2>
  <h3>21/12/2025</h3>
</div>

<div class="card">
  <div id="status" class="loading">Đang tải dữ liệu...</div>
  <div id="tableWrap"></div>
</div>

<script>
/* Fetch GVIZ */
function qvFetchJSON(sheetId, sheetName) {
  const base =
    "https://docs.google.com/spreadsheets/d/" +
    encodeURIComponent(sheetId) +
    "/gviz/tq?tqx=out:json&sheet=" +
    encodeURIComponent(sheetName);

  return fetch(base, { cache: "no-store" })
    .then(r => r.text())
    .then(text => {
      const m = text.match(/setResponse\\(([\\s\\S]+)\\)/);
      if (!m) throw new Error("Không đọc được dữ liệu!");
      return JSON.parse(m[1]);
    });
}

/* Tách nhóm từ sheet */
function splitGroups(rows) {
  const groups = [
    { start: 0, end: 7 },   // A1:G8
    { start: 9, end: 16 },  // A10:G17
    { start: 18, end: 25 }, // A19:G26
    { start: 27, end: 34 }  // A28:G35
  ];

  return groups.map(g => {
    const title1 = rows[g.start]?.c || [];
    const title2 = rows[g.start + 1]?.c || [];
    const data = rows.slice(g.start + 2, g.end + 1);
    return { title1, title2, data };
  });
}

function esc(v) {
  return v == null ? "" : String(v)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");
}

/* Render nhóm */
function renderGroups(groups, cols) {
  const wrap = document.getElementById("tableWrap");
  wrap.innerHTML = "";

  groups.forEach(g => {
    const box = document.createElement("div");
    box.className = "group-box";

    const title = document.createElement("div");
    title.className = "group-title";

    title.innerHTML =
      esc(g.title1.map(c => c?.v ?? "").join(" ")) + "<br>" +
      esc(g.title2.map(c => c?.v ?? "").join(" "));

    box.appendChild(title);

    const table = document.createElement("table");

    let header = "<tr>" + cols.map(c => "<th>"+esc(c.label)+"</th>").join("") + "</tr>";
    let body = "";

    g.data.forEach(r => {
      body += "<tr>" +
        r.c.map(cell => "<td>"+ esc(cell?.v) +"</td>").join("") +
        "</tr>";
    });

    table.innerHTML = "<thead>" + header + "</thead><tbody>" + body + "</tbody>";
    box.appendChild(table);
    wrap.appendChild(box);
  });
}

/* Auto refresh */
const SHEET_ID = "1QOnDy3RJydEpNXnuTdRzUTwCNohp00FzZxA7xCraXAY";
const SHEET_NAME = "bang";

function loadSheet() {
  qvFetchJSON(SHEET_ID, SHEET_NAME)
    .then(data => {
      const rows = data.table.rows || [];
      const cols = data.table.cols || [];

      const groups = splitGroups(rows);
      renderGroups(groups, cols);

      document.getElementById("status").textContent =
        "Cập nhật: " + new Date().toLocaleTimeString();
    })
    .catch(err => {
      document.getElementById("status").textContent = "Lỗi: " + err.message;
    });
}

loadSheet();
setInterval(loadSheet, 1000);
</script>

</body>
</html>
