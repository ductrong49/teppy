<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<!-- NGĂN ZOOM TRÊN DI ĐỘNG -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BẢNG THI ĐẤU</title>
<style>
  /* reset + box sizing */
  *, *::before, *::after { box-sizing: border-box; }
  html,body { height: 100%; margin: 0; padding: 0; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }

  /* cơ bản - mobile-first */
  :root{
    --bg:#f4f7fb;
    --card-bg: rgba(255,255,255,0.9);
    --accent-1: #e53e3e;
    --accent-2: #2b6cb0;
    --radius: 12px;
    --gap: 12px;
  }

  body{
    font-family: Arial, "Helvetica Neue", sans-serif;
    background: url("image.jpg") center/cover no-repeat;
    background-attachment: scroll; /* tránh fixed trên mobile */
    padding: 14px;
    color: #111;
    /* chữ linh hoạt: tối thiểu 15px, tối đa ~20px */
    font-size: clamp(15px, 4.2vw, 20px);
    -webkit-font-smoothing:antialiased;
  }

  .container{
    max-width: 980px;
    margin: 0 auto;
  }

  h1,h2,h3{
    margin: 0;
    padding: 0;
    line-height: 1.2;
    text-align: center;
    text-shadow: 1px 1px 3px rgba(255,255,255,0.6);
  }
  h1{ font-size: 1.25rem; margin-bottom: 4px; }
  h2{ font-size: 1rem; margin-bottom: 6px; }
  h3{ font-size: .9rem; margin-bottom: 10px; opacity: .9; }

  /* Top groups: trên điện thoại cho phép cuộn ngang */
  #top-groups{
    display: flex;
    gap: var(--gap);
    margin: 16px 0;
    /* nếu không đủ chỗ sẽ cho cuộn ngang */
    overflow-x: auto;
    padding-bottom: 6px;
    -webkit-overflow-scrolling: touch;
  }
  /* ẩn thanh cuộn trên một số trình duyệt (tuỳ chọn) */
  #top-groups::-webkit-scrollbar{ height:8px; }
  #top-groups::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.12); border-radius: 8px; }

  .top-group{
    flex: 0 0 auto; /* không co lại quá nhỏ, cho cuộn */
    min-width: 160px; /* điều chỉnh nếu cần */
    background: var(--card-bg);
    border: 3px solid var(--accent-1);
    border-radius: var(--radius);
    padding: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
  }
  .top-title{
    text-align: center;
    font-weight: 700;
    margin-bottom: 8px;
    font-size: .95rem;
  }

  /* Các group lớn (dưới) */
  .group{
    margin: 16px 0;
    padding: 10px;
    background: var(--card-bg);
    border-radius: var(--radius);
    border: 3px solid var(--accent-2);
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
  }
  .group-title{
    font-weight: 700;
    text-align: center;
    margin-bottom: 10px;
    font-size: 1rem;
  }

  table{
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }
  th, td{
    border: 1px solid #555;
    padding: 6px 8px;
    text-align: center;
    background: white;
    word-break: break-word;
  }
  th{ background: #c6e2ff; font-weight: 700; font-size: .95rem; }

  .small-table th{ background: #ffe5e5; }

  /* responsive: trên tablet/desktop hiển thị 4 nhóm ngang */
  @media (min-width: 700px){
    #top-groups{
      overflow-x: visible;
      flex-wrap: nowrap;
      justify-content: space-between;
    }
    .top-group{ flex: 1 1 0; min-width: 0; }
    .top-group + .top-group{ margin-left: var(--gap); }
    h1{ font-size: 1.6rem; }
    h2{ font-size: 1.1rem; }
    h3{ font-size: 1rem; }
  }

  /* nếu background ảnh gây rối trên mobile, có thể làm mờ/overly */
  .bg-overlay{
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.15);
    pointer-events: none;
    z-index: 0;
  }

  /* nhỏ gọn: giảm khoảng cách bảng trên màn nhỏ */
  @media (max-width: 420px){
    body{ padding: 10px; }
    .top-group{ padding: 6px; min-width: 150px; }
    th,td{ padding: 5px 6px; font-size: .88rem; }
  }
</style>
</head>
<body>
  <div class="container" role="main">
    <h1>TEPPY and LADIES</h1>
    <h2>PICKLEBALL CUP</h2>
    <h3>21/12/2025</h3>

    <!-- Nhóm I-J ngang (cuộn ngang trên mobile nếu cần) -->
    <div id="top-groups" aria-label="Bảng A B C D">
      <!-- nội dung sẽ được render bởi JS -->
    </div>

    <!-- Các nhóm A-G (dưới) -->
    <div id="groups"></div>
  </div>

  <!-- lớp overlay nhẹ (tuỳ chọn) -->
  <div class="bg-overlay" aria-hidden="true"></div>

<script>
const SHEET_ID = "1QOnDy3RJydEpNXnuTdRzUTwCNohp00FzZxA7xCraXAY";
const SHEET_NAME = "bang";
const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}`;

async function loadData(){
  try{
    const res = await fetch(API_URL);
    let text = await res.text();

    // xử lý định dạng trả về của Google (gviz)
    text = text.substring(text.indexOf("(") + 1, text.lastIndexOf(")"));
    const json = JSON.parse(text);
    const rows = json.table.rows.map(r => r.c ? r.c.map(c => c ? c.v : "") : []);

    renderTopGroups(rows);
    renderGroups(rows);
  }catch(e){
    console.error("Lỗi tải dữ liệu:", e);
    // hiển thị thông báo đơn giản cho người dùng (không bắt buộc)
    document.getElementById("groups").innerHTML = `<div class="group"><div class="group-title">Lỗi tải dữ liệu</div><div style="text-align:center;color:#a00">Không thể kết nối tới bảng</div></div>`;
  }
}

function getRange(rows, start, end){
  return rows.slice(start - 1, end);
}

function renderTable(range, colStart, colEnd, small = false){
  const cls = small ? "small-table" : "";
  let html = `<table class="${cls}">`;
  range.forEach((row, idx) => {
    html += "<tr>";
    const cells = row.slice(colStart, colEnd);
    // nếu hàng thiếu ô thì thêm ô rỗng
    for(let i=0;i<colEnd-colStart;i++){
      const cell = typeof cells[i] !== "undefined" ? cells[i] : "";
      if(idx < 2) html += `<th>${escapeHtml(cell)}</th>`;
      else html += `<td>${escapeHtml(cell)}</td>`;
    }
    html += "</tr>";
  });
  html += "</table>";
  return html;
}

function renderTopGroups(rows){
  const groups = [
    { title: "BẢNG A", start: 1, end: 6 },
    { title: "BẢNG B", start: 10, end: 15 },
    { title: "BẢNG C", start: 19, end: 24 },
    { title: "BẢNG D", start: 28, end: 33 },
  ];
  let html = "";
  groups.forEach(g => {
    const range = getRange(rows, g.start, g.end);
    html += `
      <div class="top-group" role="region" aria-label="${g.title}">
        <div class="top-title">${g.title}</div>
        ${renderTable(range, 8, 10, true)}
      </div>
    `;
  });
  document.getElementById("top-groups").innerHTML = html;
}

function renderGroups(rows){
  const groups = [
    { title: "NHÓM 1 (A1:G8)", start: 1, end: 8 },
    { title: "NHÓM 2 (A10:G17)", start: 10, end: 17 },
    { title: "NHÓM 3 (A19:G26)", start: 19, end: 26 },
    { title: "NHÓM 4 (A28:G35)", start: 28, end: 35 }
  ];
  let html = "";
  groups.forEach(g => {
    const range = getRange(rows, g.start, g.end);
    html += `
      <div class="group" role="region" aria-label="${g.title}">
        <div class="group-title">${g.title}</div>
        ${renderTable(range, 0, 7)}
      </div>
    `;
  });
  document.getElementById("groups").innerHTML = html;
}

// tránh XSS: escape đơn giản
function escapeHtml(s){
  if(s === null || s === undefined) return "";
  return String(s).replace(/[&<>"']/g, function(m){
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
  });
}

loadData();
// cập nhật định kỳ (bạn có thể tăng interval nếu dữ liệu không cần tươi real-time)
setInterval(loadData, 5000);
</script>
</body>
</html>
