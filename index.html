function renderTable(range, colStart, colEnd, small = false) {
    let cls = small ? "small-table" : "";
    let html = `<table class="${cls}">`;

    const cols = colEnd - colStart;

    for (let r = 0; r < range.length; r++) {
        html += "<tr>";

        for (let c = colStart; c < colEnd; c++) {
            // Nếu là ô đã được xử lý merge thì bỏ qua
            if (range[r][c] === "__MERGED__") continue;

            let value = range[r][c] ?? "";
            let colspan = 1;
            let rowspan = 1;

            // Merge Ngang (colspan)
            for (let cc = c + 1; cc < colEnd; cc++) {
                if (range[r][cc] === "") {
                    colspan++;
                    range[r][cc] = "__MERGED__";
                } else break;
            }

            // Merge Dọc (rowspan)
            for (let rr = r + 1; rr < range.length; rr++) {
                if (range[rr][c] === "") {
                    rowspan++;
                    range[rr][c] = "__MERGED__";
                } else break;
            }

            // Header hay Data?
            let tag = r < 2 ? "th" : "td";

            html += `<${tag} colspan="${colspan}" rowspan="${rowspan}">${value}</${tag}>`;
        }

        html += "</tr>";
    }

    html += "</table>";
    return html;
}
